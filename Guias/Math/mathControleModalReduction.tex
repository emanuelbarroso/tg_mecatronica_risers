%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Short Sectioned Assignment
% LaTeX Template
% Version 1.0 (5/5/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Frits Wenneker (http://www.howtotex.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[a4paper,11pt]{scrartcl} % A4 paper and 11pt font size

\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
\usepackage[utf8]{inputenc}
\usepackage{fourier} % Use the Adobe Utopia font for the document - comment this line to return to the LaTeX default
\usepackage[brazilian]{babel} % English language/hyphenation
\usepackage{amsmath,amsfonts,amsthm} % Math packages

\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template
\usepackage{graphicx}
\usepackage{sectsty} % Allows customizing section commands
\allsectionsfont{\centering \normalfont\scshape} % Make all sections centered, the default font and small caps
\usepackage{float}
\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers
\fancyhead{} % No page header - if you want one, create it in the same way as the footers below
\fancyfoot[L]{} % Empty left footer
\fancyfoot[C]{} % Empty center footer
\fancyfoot[R]{\thepage} % Page numbering for right footer
\renewcommand{\headrulewidth}{0pt} % Remove header underlines
\renewcommand{\footrulewidth}{0pt} % Remove footer underlines
\setlength{\headheight}{13.6pt} % Customize the height of the header

\numberwithin{equation}{section} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{figure}{section} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{table}{section} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)

\setlength\parindent{0pt} % Removes all indentation from paragraphs - comment this line for an assignment with lots of text

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\newcommand{\horrule}[1]{\rule{\linewidth}{#1}} % Create horizontal rule command with 1 argument of height

\title{	
\normalfont \normalsize 
\textsc{Universidade de Brasília} \\ [25pt] % Your university, school and/or department name(s)
\horrule{0.5pt} \\[0.4cm] % Thin top horizontal rule
\huge Implementação de Controle com Redução Modal \\ % The assignment title
\horrule{2pt} \\[0.5cm] % Thick bottom horizontal rule
}

\author{Ataias Pereira Reis \\ Emanuel Pereira Barroso Neto} % Your name

\date{\normalsize\today} % Today's date or a custom date

\usepackage{beramono}
\usepackage{listings}
\usepackage[usenames,dvipsnames]{xcolor}

%%
%% Julia definition (c) 2014 Jubobs
%%
\lstdefinelanguage{Julia}%
  {morekeywords={abstract,break,case,catch,const,continue,do,else,elseif,%
      end,export,false,for,function,immutable,import,importall,if,in,%
      macro,module,otherwise,quote,return,switch,true,try,type,typealias,%
      using,while},%
   sensitive=true,%
   alsoother={\$},%
   morecomment=[l]\#,%
   morecomment=[n]{\#=}{=\#},%
   morestring=[s]{"}{"},%
   morestring=[m]{'}{'},%
}[keywords,comments,strings]%

\lstset{%
    language         = Julia,
    basicstyle       = \ttfamily,
    keywordstyle     = \bfseries\color{blue},
    stringstyle      = \color{magenta},
    commentstyle     = \color{ForestGreen},
    showstringspaces = false,
}


\begin{document}

\maketitle % Print the title

%----------------------------------------------------------------------------------------
%	PROBLEM 1
%----------------------------------------------------------------------------------------

\section{Introdução}
\paragraph{} O objetivo deste documento é apresentar os procedimentos necessários para implementar o método controle apresentado no artigo ``\textit{Modal Reduction Based Tracking Control for Installation of Subsea Equipments}'', desenvolvido por Fabrício et al, em um controlador industrial da Rockwell. Nem todos os detalhes estão presentes no artigo, o que torna difícil simplesmente lê-lo e realizar o sistema.

\section{Equações Governantes}
\paragraph{} Para o riser, a Equação \ref{equacaoMorison} representa o deslocamento horizontal $\Upsilon(z,t)$ do tubo --- um barbante, no caso da bancada de laboratório --- sob a ação de forças hidrodinâmicas externas $F_n(z,t)$ e tração $T(z)$: \begin{align}
	m_s \frac{\partial^2 \Upsilon}{\partial t^2} &= -EJ \frac{\partial^4 \Upsilon}{\partial z^4} + 	\frac{\partial}{\partial z}\left(T(z)\frac{\partial \Upsilon}{\partial z}\right)+F_n(z,t) \label{equacaoMorison}
\end{align}

\paragraph{} Antes de prosseguir, é importante definir termos desta equação: \begin{itemize}
	\item $m_s$ é a massa linear do barbante (o professor Eugênio disse isso, mas o que seria massa linear? É a densidade linear? Ou é simplesmente a massa do barbante?) %TODO Confirmar o que seria massa linear do barbante
	\item $E$ é o módulo de Young do barbante e ele é desconhecido
	\item $J$ é o segundo momento de área e representa a resistência do barbante à flexão. O barbante não apresenta tal resistência, daí $J=0$
	\item $T(z)$ é a força de tração e é dada por \[T(z) = \left(m_b+\frac{z}{L}m_s\right)g,\] sendo $m_b$ a massa da bolinha, $L$ o comprimento do barbante, $z$ a posição vertical sendo o carrinho o zero e $g$ é a força da gravidade. (Aqui, estou considerando $m_s$ como a massa total do barbante. Caso fosse densidade linear, $T(z) = (m_b + z\cdot m_s) g$)
\end{itemize}

\paragraph{} A força externa resultante, $F_n(z,t)$, é dada por \begin{align}
	F_n(z,t) &= -m_f \frac{\partial^2 \Upsilon}{\partial t^2} - \mu \left|\frac{\partial \Upsilon}{\partial t}\right|\frac{\partial \Upsilon}{\partial t}\label{forceN},
\end{align} na qual $\mu$ é o coeficiente de arrasto e $m_f$ é a massa do fluido adicionado, que será posteriormente pormenorizada. Fazendo $m = m_s + m_f$ e substituindo a Equação \ref{forceN} na \ref{equacaoMorison}, obtém-se: \begin{align}
	\frac{\partial^2 \Upsilon}{\partial t^2} &= -\frac{EJ}{m}\frac{\partial^4 \Upsilon}{\partial z^4} + \frac{\partial}{\partial z}\left(\frac{T(z)}{m}\frac{\partial \Upsilon}{\partial z}\right) - \frac{\mu}{m}\left|\frac{\partial \Upsilon}{\partial t}\right|\frac{\partial \Upsilon}{\partial t}
\end{align}


\paragraph{} No artigo do Fabrício, fala ``\textit{Since the traction $T (z)$ is mostly due to the heavy payload,it can be assumed an average value $T$ for it, taken in the            middle of the riser’s length.}''. Eu suspeito da veracidade desta frase quando analisado os dados \begin{itemize}
            	\item Massa do isopor: 0.15g
	\item Diâmetro da bolinha: 30.6mm
	\item Massa do barbante: 0.492g
	\item Comprimento do barbante: 0.82m
	\item Diâmetro do barbante: 2mm
	\item Densidade linear considerando densidade volumétrica 191kg/m$^3$ é de 0.6g/m.
\item Massa do barbante pela da bolinha aproximadamente 3 (0.492/0.15).
            \end{itemize}
         
\paragraph{} A massa do barbante, $m_s = 0.492\mathrm{g}$, é bem maior que a massa $m_f$ do fluido adicionado. Para verificar isso, calculemos primeiro a massa $m_{f1}$ do fluido adicionado ao redor do barbante: \begin{align}
	m_{f1} &= 2 V_b \rho_{\mathrm{ar}}\nonumber\\
	&= 2 \pi r^2 L\rho_{\mathrm{ar}}\nonumber\\
	&= 0.025246\mathrm{g}
\end{align} e a massa $m_{f2}$ do fluido adicionado ao redor da bolinha de isopor é \begin{align}
	m_{f2} &= 1.2 V_{e} \rho_{\mathrm{ar}}\nonumber\\
	&= 1.2 \left(\frac{4}{3}\pi r^3\right)\rho_{\mathrm{ar}}\nonumber\\
	&= 4.926\cdot 10^{-5}
\end{align}

\paragraph{} A massa do fluido adicionado é aproximadamente $m_f = m_{f1} + m_{f2} = 0.0253\mathrm{g}$. Tem que a massa do barbante é $m_s/m_f = 19.45$ vezes maior que a massa do fluido adicionado. 
            
\paragraph{} Nota-se que o barbante pesa mais que o isopor, o que faria com que a tração não fosse principalmente devida pela bolinha de isopor, mas sim pelo barbante. Neste caso, não se prossegue usando um valor médio para $T(z)$ como no artigo do Fabrício, mas ainda se define uma constante $\tau$ que substitui o termo $\frac{\mu}{m}\left|\frac{\partial \Upsilon}{\partial t}\right|$ já levando em conta um valor médio para $\left|\frac{\partial \Upsilon}{\partial t}\right|$, resultando em \begin{align}
	\frac{\partial^2 \Upsilon}{\partial t^2} &= -\frac{EJ}{m}\frac{\partial^4 \Upsilon}{\partial z^4} + \frac{\partial}{\partial z}\left(\frac{T(z)}{m}\frac{\partial \Upsilon}{\partial z}\right) - \tau\frac{\partial \Upsilon}{\partial t}\label{EquacaoComTau}
	\end{align}
	
\paragraph{} Antes de prosseguirmos para a discretização, e então obter as matrizes em espaço de estados, é importante pensar nas condições de contorno. No topo, $z=L$, tem-se $\Upsilon(L,t)=u(t)$, ou seja, o carrinho se move conforme uma trajetória $u(t)$ definida. Neste mesmo ponto, $\frac{\partial\Upsilon}{\partial z}(L,t) = 0$. Para a ponta na qual a carga está situada, $z=0$, tem-se $\frac{\partial\Upsilon}{\partial z}(0,t) = \frac{F_L}{T}$, sendo $F_L$ a força aplicada pela ponta do riser na carga. (Outra coisa que confundi, eu entendi $u(t)$ sendo uma trajetória, pois $\Upsilon$ é deslocamento, mas no artigo do Fabrício está escrito em uma momento que é uma força).

\subsection{Discretização}
\paragraph{} De forma a se realizar o controle proposto, o sistema deve ter um espaço de estados finito. Para isso, aplica-se o método de diferenças finitas na coordenada $z$ de maneira a se aproximar a EDP governante em um número finito de EDOs. No espaço discreto, a equação do $k$-ésimo elemento é dada por \begin{align}
	\frac{d^2\Upsilon_k}{dt^2} &= -\frac{EJ}{m l^4}\left(\Upsilon_{k-2} - 4\Upsilon_{k-1}+6\Upsilon_{k}-4\Upsilon_{k+1}+\Upsilon_{k+2}\right)\nonumber\\
	&+ \frac{T_0+mg(k-1)l}{m l^2}\left(\Upsilon_{k-1}-2\Upsilon_{k} + \Upsilon_{k+1}\right)+g\frac{-\Upsilon_{k-1}+\Upsilon_{k+1}}{2l}-\tau\frac{d\Upsilon_k}{dt},
\end{align} sendo $l$ a distância entre dois pontos de discretização ($l = L/N$), $L$ é o comprimento do riser e $N$ é o número de pontos de discretização. (A tração $T(z)$ foi trocada por $T$ já na Equação  \ref{EquacaoComTau}, sendo um valor médio).

\paragraph{} Sendo $k\in \mathbb{N}:1\le k \le N$, o que aconteceria quando $k=1$ e se precisasse de $\Upsilon_{k-1}$ e $\Upsilon_{k-2}$? Na realidade, os $N$ pontos se referem aos pontos internos e então este problema não deve ocorrer.

\paragraph{} Para simplificar, definem-se as constantes \begin{align}
	a &= -\frac{EJ}{m l^4}\\
	b_k &= \frac{T_0 + mg(k-1)l}{m l^4},\; k\ge 2\\
	c &= b + \frac{g}{2l}\\
	d_k &= b_k - c,\; k\ge 2\\
	e_k &= b_k + c,\; k\ge 2
\end{align}

\paragraph{} A meu ver, a melhor forma de se analisar como as matrizes do sistema ficarão é expandir o sistema para casos com $N$ pequeno e ver o que está ocorrendo. Observe que $a=0$ para o barbante, o que simplifica os próximos passos.

\paragraph{} Para o caso $N=6$, tem-se \begin{align}
\mathbf{x} &= \left(\Upsilon_1\;\Upsilon_2\;\Upsilon_3\;\Upsilon_4\;\Upsilon_5\;\Upsilon_6\;\dot{\Upsilon}_1\;\dot{\Upsilon}_2\;\dot{\Upsilon}_3\;\dot{\Upsilon}_4\;\dot{\Upsilon}_5\;\dot{\Upsilon}_6\right)^T 	\\
u &= \Upsilon(L,t) = \Upsilon_7\label{ufor6}\\
y &= \Upsilon(0,t) = \Upsilon_1\label{yfor6}
 \end{align} e as equações são \begin{align}
 	\ddot{\Upsilon}_2 &=  b_2\left(\Upsilon_{1}-2\Upsilon_{2} + \Upsilon_{3}\right)+c(-\Upsilon_1 + \Upsilon_3)-\tau \dot{\Upsilon}_2\nonumber \\
 	&= d_2\Upsilon_1 - 2b_2 \Upsilon_2 + e_2\Upsilon_3 - \tau \dot{\Upsilon}_2\\
 	\ddot{\Upsilon}_3 &=  b_3\left(\Upsilon_{2}-2\Upsilon_{3} + \Upsilon_{4}\right)+c(-\Upsilon_2 + \Upsilon_4)-\tau \dot{\Upsilon}_3\nonumber \\
 	&= d_3\Upsilon_2 - 2b_3 \Upsilon_3 + e_3\Upsilon_4 - \tau \dot{\Upsilon}_3\\
 	\ddot{\Upsilon}_4 &=  b_4\left(\Upsilon_{3}-2\Upsilon_{4} + \Upsilon_{5}\right)+c(-\Upsilon_3 + \Upsilon_5)-\tau \dot{\Upsilon}_4 \nonumber\\
 	&= d_4\Upsilon_3 - 2b_4 \Upsilon_4 + e_4\Upsilon_5 - \tau \dot{\Upsilon}_4\\
 	\ddot{\Upsilon}_5 &=  b_5\left(\Upsilon_{4}-2\Upsilon_{5} + \Upsilon_{6}\right)+c(-\Upsilon_4 + \Upsilon_6)-\tau \dot{\Upsilon}_5\nonumber\\
 	&= d_5\Upsilon_4 - 2b_5 \Upsilon_5 + e_5\Upsilon_6 - \tau \dot{\Upsilon}_5\\
 	\ddot{\Upsilon}_6 &=  b_6\left(\Upsilon_{5}-2\Upsilon_{6} + u\right)+c(-\Upsilon_5 + u)-\tau \dot{\Upsilon}_6\nonumber\\
 	&= d_6\Upsilon_5 - 2b_6 \Upsilon_6 + e_6 u - \tau \dot{\Upsilon}_6
 \end{align} 
 
 \paragraph{} A equação para a posição da carga $\Upsilon_1$ leva em conta a massa da bolinha e a força de Morison: \begin{align}
 	m_b \ddot{\Upsilon}_1 &= \frac{m_b g}{(N-1)l}\left(\Upsilon_2 - \Upsilon_1\right) + \rho C_m V \ddot{\Upsilon}_1 - \frac{1}{2}\rho C_d A \dot{\Upsilon}_1 \left|\dot{\Upsilon}_1\right|,
 \end{align} e, isolando-se $\ddot{\Upsilon}_1$, tem-se \begin{align}
 	\ddot{\Upsilon}_1 &= \frac{m_b g}{m'(N-1)l}\left(\Upsilon_2 - \Upsilon_1\right)  - \frac{1}{2m'}\rho C_d A \dot{\Upsilon}_1 \left|\dot{\Upsilon}_1\right|,
 \end{align} com as constantes \begin{itemize}
 	\item $\rho = 1.225\mathrm{kg}/\mathrm{m}^3$, a densidade do ar
 	\item $C_m = 2$, o coeficiente de inércia da esfera
 	\item $C_d = 0.6$, o coeficiente de arrasto da esfera
 	\item $V = \frac{4}{3}\pi r^3$, o volume da esfera
 	\item $A = \pi r^2$, a área da maior seção transversal da esfera
 	\item $m' = m_b + \rho C_m V$
 \end{itemize}
 
 \paragraph{} Anteriormente, foi apresentada a linearização $\tau$ para o termo $\frac{1}{2m}\rho C_d A\left|\dot{\Upsilon}_k\right|$ do cabo. Assumo que isso também seja necessário para a bola, resultando em um $\tau'$: \begin{align}
 	\ddot{\Upsilon}_1 &= b_1\left(-\Upsilon_1 + \Upsilon_2\right) - \tau'\dot{\Upsilon}_1,
 \end{align} com $b_1 = \frac{m_b g}{m' (N-1)l}$.
 
 \paragraph{} Desta forma, pode-se definir o sistema linear em forma matricial \begin{align}
 	\mathbf{\dot{x}} &= \left[\begin{array}{cccccccccccc}
 		0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0\\
 		0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0\\
 		0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0\\
 		0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0\\
 		0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0\\
 		0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1\\
 		-b_1 & b_1 & 0 & 0 & 0 & 0 & -\tau' & 0     & 0 & 0 & 0 & 0\\
 		d_2 & -2b_2  & e_2  & 0  & 0 & 0 &  0    & -\tau & 0 & 0 & 0 & 0\\
 		0 & d_3 & -2b_3  & e_3  & 0  & 0 & 0 &  0    & -\tau & 0 & 0 & 0\\
 		0 & 0 & d_4 & -2b_4  & e_4  & 0  & 0 & 0 &  0    & -\tau & 0 & 0\\
 		0 & 0 & 0 & d_5 & -2b_5  & e_5  & 0  & 0 & 0 &  0    & -\tau & 0\\
 		0 & 0 & 0 & 0 & d_6 & -2b_6  & 0  & 0 & 0 &  0    & 0   &-\tau\\
 	\end{array}\right]\mathbf{x} + \left[\begin{array}{c}
	0\\	0\\	0\\	0\\	0\\ 0\\ 0\\ 0\\ 0\\ 0\\ 0\\ e_6
\end{array}
\right]u
 \end{align} que pode ser representado concisamente como \begin{align}
 	\mathbf{\dot{x}} &= \left[\begin{array}{cc}
	\mathbf{0}_{6\times 6} & \mathbf{I}_{6\times 6}\\
	\mathbf{M}_{6\times 6} & \mathbf{L}_{6\times 6}\\
\end{array}\right] \mathbf{x} + \left[\begin{array}{c}
	\mathbf{0}_{11\times 1}\\ e_6\\
\end{array} \right]u
 \end{align} 
 
 Para o caso de uma discretização com $N$ pontos, tem-se \begin{align}
 	\mathbf{\dot{x}} &= \left[\begin{array}{cc}
	\mathbf{0}_{N\times N} & \mathbf{I}_{N\times N}\\
	\mathbf{M}_{N\times N} & \mathbf{L}_{N\times N}\\
\end{array}\right] \mathbf{x} + \left[\begin{array}{c}
	\mathbf{0}_{2N-1\times 1}\\ e_N\\
\end{array} \right]u
 \end{align}
% 
% \paragraph{} Esta matriz fornece um padrão que pode ser utilizado para se criar um algoritmo que gera as matrizes $\mathbf{A}$ e $\mathbf{B}$ automaticamente, sendo $\mathbf{\dot{x}} = \mathbf{A}\mathbf{x}+\mathbf{B}u$.
% 
% \lstinputlisting[language=Julia,caption={Código para gerar matrizes A, B e C},label=generateABC]{code/GenerateABC.jl}

\section{Uma Estratégia de Redução da Ordem do Modelo}
\paragraph{} A maior parte da teoria clássica de controle lida com sistemas representados por um pequeno número de variáveis de estado. Portanto, uma forma de aplicar métodos clássicos de controle da literatura para sistemas de parâmetros distribuídos discretos é por meio de uma redução da ordem do modelo.

\paragraph{} Tal redução do modelo será feita em duas etapas: primeiro, uma transformação modal é aplicada nas equações originais do espaço de estados, resultando em uma nova representação em variáveis modais. Nesta forma, o sistema pode ser visto como um conjunto de subsistemas dissociados em paralelo, cuja influência na saída pode ser calculada individualmente. Então, os subsistemas com os maiores ganhos estáticos são escolhidos para criar um modelo de ordem reduzida.

\subsection{Decomposição Modal}

\paragraph{} Primeiro, deve-se obter os autovalores do espaço de estados do \textit{riser}. Observa-se que eles são sempre distintos entre si, uma condição suficiente para a diagonalização da matriz do espaço de estados. Assim, calcula-se a matriz modal \textbf{T}, cuja i-ésima coluna é o i-ésimo autovetor do sistema: \begin{align}
	\mathbf{T} &= (\;\mathbf{v_1}\;|\;\mathbf{v_2}\;|\;\ldots\;|\;\mathbf{v_{2N}}\;)_{1\times 2N}
\end{align}

\paragraph{} A matriz $\mathbf{T}$ é utilizada para uma transformação de similaridade no sistema original: \begin{align}
	\mathbf{A_M} &= \mathbf{T}^{-1}\mathbf{A}\mathbf{T},\\
	\mathbf{x_M} &=\mathbf{T}^{-1}\mathbf{x},	\\
	\mathbf{B_M} &= \mathbf{T}^{-1}\mathbf{B},\textrm{ e}\\
	\mathbf{C_M} &=\mathbf{C}\mathbf{T}.
\end{align}

\paragraph{} O sistema transformado, denotado pelo subscrito $\mathbf{M}$, é mais adequado à análise. $\mathbf{A_M}$ é uma matriz diagonal, com seus autovalores explícitos, e permitindo o desacoplamento do sistema original em $N$ subsistemas de segunda ordem formados por pares de autovalores reais ou complexo-conjugados.

%TODO Escrever o código para criar a matriz T e fazer a transformação de similaridade

\subsection{Redução Modal}

\end{document}
